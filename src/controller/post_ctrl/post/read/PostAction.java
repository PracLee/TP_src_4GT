package controller.post_ctrl.post.read;

import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import controller.Action;
import controller.ActionForward;
import model.comments.CommentsVO;
import model.post.PostDAO;
import model.post.PostVO;

public class PostAction implements Action {

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		ActionForward action = new ActionForward();
		PostDAO PDAO = new PostDAO();
		PostVO PVO = new PostVO();
		String initial = request.getParameter("category");
		String category = "";
		if(initial.equals("hot")) {
			category = "인기글";
		}else if(initial.equals("chi")) {
			category = "치킨";
		}else if(initial.equals("piz")) {
			category = "피자";
		}else if(initial.equals("ham")) {
			category = "햄버거";
		}else if(initial.equals("kor")) {
			category = "한식";
		}else if(initial.equals("cha")) {
			category = "중식";
		}else if(initial.equals("jap")) {
			category = "일식";
		}
		ArrayList<PostVO> datas = new ArrayList<PostVO>();
		if(category.equals("인기글")) {
			datas = PDAO.SelectViews();
		}else {
			PVO.setCategory(category);
			datas = PDAO.SelectCategory(PVO);
		}
		/*ArrayList<CommentsVO> CommentDatas = (ArrayList<CommentsVO>) request.getAttribute("CommentDatas");
		ArrayList<Integer> commentsCnt = new ArrayList<Integer>(datas.size()); // 포스트 리스트와 같은 크기를 가진 댓글수 AL생성
		for (int i = 0; i < commentsCnt.size(); i++) { // 댓글수 AL 0으로 초기화
			commentsCnt.set(i, 0);
		}
		for (int i = 0; i < CommentDatas.size(); i++) {
			int index = (CommentDatas.get(i).getC_post() - 1);
			commentsCnt.add(index, (commentsCnt.get(index) + 1)); // commentsCnt index = postnum - 1
		}*/	// 댓글수 로직 -> 0927 model column 추가로 삭제
		request.setAttribute("category", category);
		request.setAttribute("PostList", datas); // PostList로 SelectAll 데이터를 넘김
		// request.setAttribute("commentsCnt", commentsCnt); // 댓글 수 AL로 넘김 0번 인덱스에 1번 포스트의 댓글 갯수 담겨있음! 댓글수 로직 -> 0927 model column 추가로 삭제
		action.setPath("ShowList.jsp");
		action.setRedirect(false);
		return action;
	}

}
